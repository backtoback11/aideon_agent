{% extends "base.html" %}
{% set active_page = "dashboard" %}

{% block title %}Dashboard — Aideon Agent{% endblock %}

{% block content %}
<h1 class="main-title">Дашборд</h1>

<!-- Быстрые действия -->
<div class="actions-row">
    <a href="{{ request.url_for('invoices_create_form') }}" class="btn-primary">
        + Создать инвойс
    </a>
    <a href="{{ request.url_for('invoices_list') }}" class="btn-secondary">
        Список инвойсов
    </a>
    <a href="{{ request.url_for('list_proxies') }}" class="btn-secondary">
        Прокси
    </a>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-label">Всего инвойсов</div>
        <div class="stat-value">{{ total }}</div>
    </div>

    <div class="stat-card">
        <div class="stat-label">В очереди (queued)</div>
        <div class="stat-value">{{ queued }}</div>
    </div>

    <div class="stat-card">
        <div class="stat-label">Обрабатывается (processing)</div>
        <div class="stat-value">{{ processing }}</div>
    </div>

    <div class="stat-card">
        <div class="stat-label">Ждут капчу (waiting_captcha)</div>
        <div class="stat-value">{{ waiting }}</div>
    </div>

    <div class="stat-card">
        <div class="stat-label">Ошибки (error)</div>
        <div class="stat-value">{{ error }}</div>
    </div>

    <div class="stat-card">
        <div class="stat-label">Активные прокси (записей)</div>
        <div class="stat-value">{{ proxies }}</div>
    </div>
</div>

<!-- Воркеры -->
<h2 class="section-title" style="margin-top: 32px;">Воркеры</h2>

<div class="stats-grid">
    <!-- Основной агент (Aideon Agent) -->
    <div class="stat-card">
        <div class="stat-label">Aideon Agent (основной воркер)</div>
        <div class="stat-value">
            {% if agent_worker_enabled %}
                <span class="status-badge status-ok">Активен</span>
            {% else %}
                <span class="status-badge status-off">Остановлен</span>
            {% endif %}
        </div>
        <div class="stat-actions" style="margin-top: 12px;">
            <form method="post" action="{{ request.url_for('toggle_agent_worker') }}">
                {% if agent_worker_enabled %}
                    <button type="submit" class="btn-secondary">
                        Остановить агента
                    </button>
                {% else %}
                    <button type="submit" class="btn-primary">
                        Запустить агента
                    </button>
                {% endif %}
            </form>
        </div>
    </div>

    <!-- PrMoney воркер -->
    <div class="stat-card">
        <div class="stat-label">PrMoney воркер (приём инвойсов)</div>
        <div class="stat-value">
            {% if prmoney_worker_enabled %}
                <span class="status-badge status-ok">Активен</span>
            {% else %}
                <span class="status-badge status-off">Остановлен</span>
            {% endif %}
        </div>
        <div class="stat-actions" style="margin-top: 12px;">
            <form method="post" action="{{ request.url_for('toggle_prmoney_worker') }}">
                {% if prmoney_worker_enabled %}
                    <button type="submit" class="btn-secondary">
                        Остановить PrMoney-воркер
                    </button>
                {% else %}
                    <button type="submit" class="btn-primary">
                        Запустить PrMoney-воркер
                    </button>
                {% endif %}
            </form>
        </div>
    </div>
</div>

{% endblock %}